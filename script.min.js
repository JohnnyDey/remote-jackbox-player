let formReady=t=>{"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)};formReady(()=>{let t,e,n=document.getElementById("player"),a=document.getElementById("streamPane"),l=document.getElementById("unknownStream"),o=document.getElementById("twitchStream"),s=document.getElementById("mixerStream"),i=document.getElementById("mixerChat"),r=document.getElementById("howTo"),d=document.getElementById("gamePane"),c=document.getElementById("gameFrame"),u=document.getElementById("streamURLBar"),m=document.getElementById("streamURL"),h=document.getElementById("menuItems"),g=document.getElementById("menuButton"),p=document.querySelectorAll(".swapViewButton"),w=document.querySelectorAll(".swapViewButtonWrapper"),v="default",f="Remote Jackbox Player",L=null,y="",E="",B="",I="",S="";const b=n.getAttribute("class"),A=a.getAttribute("class"),x=d.getAttribute("class"),T=w.item(0).getAttribute("class");function k(){"swap"==v?(w.forEach(t=>{t.classList.remove("lg:hidden"),t.classList.remove("hidden")}),document.getElementById("reloadStreamButton").classList.remove("lg:rounded-l"),document.getElementById("reloadGameButton").classList.remove("lg:rounded-l"),document.getElementById("reloadStreamButton").classList.remove("rounded-l"),document.getElementById("reloadGameButton").classList.remove("rounded-l")):(w.forEach(t=>{t.classList.remove("lg:hidden"),t.classList.add("hidden")}),document.getElementById("reloadStreamButton").classList.remove("lg:rounded-l"),document.getElementById("reloadGameButton").classList.remove("lg:rounded-l"),document.getElementById("reloadStreamButton").classList.add("rounded-l"),document.getElementById("reloadGameButton").classList.add("rounded-l"))}function _(){a.classList.contains("z-10")?(a.classList.add("z-20"),a.classList.remove("z-10"),d.classList.add("z-10"),d.classList.remove("z-20")):(d.classList.add("z-20"),d.classList.remove("z-10"),a.classList.add("z-10"),a.classList.remove("z-20"))}function j(t){"default"===t?(v="default",n.setAttribute("class",b),a.setAttribute("class",A),d.setAttribute("class",x),w.forEach(t=>{t.setAttribute("class",T)})):"split"===t?(v="split",k(),n.setAttribute("class","flex flex-row w-screen h-screen"),a.setAttribute("class","relative w-1/2"),d.setAttribute("class","relative w-1/2")):"swap"===t?(v="swap",k(),n.setAttribute("class","w-screen h-screen"),a.classList.contains("z-10")?(a.setAttribute("class","absolute z-10 w-full h-full"),d.setAttribute("class","absolute z-20 w-full h-full")):(a.setAttribute("class","absolute z-20 w-full h-full"),d.setAttribute("class","absolute z-10 w-full h-full"))):"scroll"===t?(v="scroll",k(),n.setAttribute("class",""),a.setAttribute("class","relative w-full h-screen"),d.setAttribute("class","relative w-full h-screen")):"swipe"===t&&(v="swipe",k(),n.setAttribute("class","flex flex-no-wrap w-screen h-screen overflow-x-auto"),a.setAttribute("class","relative flex-none w-full h-full"),d.setAttribute("class","relative flex-none w-full h-full")),localStorage.setItem("rjp-activeView",t)}function H(t){let e=t;e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let n=new RegExp("[\\?|&]"+e+"=([^&#]*)").exec("?"+L.toString().split("?")[1]);return null===n?"":decodeURIComponent(n[1].replace(/\+/g,"%20"))}function R(t){let e=t;e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let n=new RegExp("[\\#|&]"+e+"=([^&#]*)").exec("#"+L.toString().split("#")[1]);return null===n?"":decodeURIComponent(n[1].replace(/\+/g,"%20"))}function z(){m.value!==y&&m.value.toString().length>8?(c.src="",c.src="https://jackbox.tv",y=m.value,""!=y?(document.title=`${f} - ${y}`,L.searchParams.set("streamURL",m.value),window.history.pushState(null,null,"?streamURL="+encodeURIComponent(y))):(document.title=""+f,L.searchParams.delete("streamURL"),window.history.pushState(null,null,"/"))):m.value.toString().length<9&&(document.title=""+f,L.searchParams.delete("streamURL"),window.history.pushState(null,null,"/"))}function C(){L=new URL(document.location.href.toString()),y=H("streamURL"),null!==localStorage.getItem("rjp-twitchAuthToken")&&(E=localStorage.getItem("rjp-twitchAuthToken")),""!==R("access_token")&&(E=R("access_token"),localStorage.setItem("rjp-twitchAuthToken",E),window.history.pushState(null,null,window.location.pathname+window.location.search)),""!==H("error")&&("The user denied you access"===H("error_description")?(alert("To find a random stream or use the followed streams list, please authorize Twitch access."),"random"===localStorage.getItem("rjp-afterAuthAction")&&localStorage.removeItem("rjp-afterAuthAction")):(localStorage.removeItem("rjp-twitchAuthToken"),O("stream"))),null!==localStorage.getItem("rjp-afterAuthAction")&&("random"===localStorage.getItem("rjp-afterAuthAction")?document.getElementById("randomStreamButton").click():y=localStorage.getItem("rjp-afterAuthAction"),localStorage.removeItem("rjp-afterAuthAction")),""!=y?(m.value=y,document.title=`${f} - ${y}`,M(),V("open"),t=setTimeout(()=>{V("close")},3e3)):(document.title=""+f,window.innerWidth<768?(V("open"),setTimeout(()=>{D("close")},3e3)):V("open"))}function U(t){function e(){l.classList.add("hidden"),l.src=""}function n(){r.classList.add("hidden")}function d(){o.classList.add("hidden"),o.innerHTML="",I=""}function c(){s.classList.add("hidden"),i.classList.add("hidden"),s.src="",i.src="",S=""}"twitch"==t?(o.classList.remove("hidden"),n(),e(),c()):"howTo"==t?(r.classList.remove("hidden"),a.scrollIntoView(!0),e(),d(),c(),$("open")):"mixer"==t?(s.classList.remove("hidden"),i.classList.remove("hidden"),n(),e(),d()):(l.classList.remove("hidden"),n(),d(),c())}function M(){if(""!=m.value)if("https://".startsWith(m.value.toString())||(m.value=m.value.toString().replace(/http:\/\//g,""),m.value=m.value.toString().replace(/https:\/\//g,""),m.value="https://"+m.value.toString()),m.value.toString().includes("remote-jackbox-player"))document.getElementById("howToButton").click();else if(m.value.toString().includes("twitch.tv")){if(""===I||I!==m.value.toString().split("/")[3]){I=m.value.toString().split("/")[3],U("twitch");let t=()=>{try{var t=new Twitch.Embed("twitchStream",{allowfullscreen:!1,width:"100%",height:"100%",channel:I,theme:"dark",layout:"video-with-chat",autoplay:!0});t.addEventListener(Twitch.Embed.VIDEO_READY,()=>{t.getPlayer().play()})}catch(t){console.error("Twitch embed setup error: \n%o",t)}};if(null==document.getElementById("ttvEmbedScript")||null==document.getElementById("ttvEmbedScript")){let e=document.createElement("script");e.setAttribute("id","ttvEmbedScript"),e.setAttribute("src","https://embed.twitch.tv/embed/v1.js"),e.addEventListener("load",t),document.body.appendChild(e)}else o.innerHTML="",t()}}else m.value.toString().includes("mixer.com")?""!==S&&S===m.value.toString().split("/")[3]||(S=m.value.toString().split("/")[3],U("mixer"),s.src="https://mixer.com/embed/player/"+m.value.toString().split("/")[3],i.src="https://mixer.com/embed/chat/"+m.value.toString().split("/")[3]):(U(),l.src!==m.value&&(l.src=m.value));else document.getElementById("howToButton").click()}function $(t){"open"==t?(P("1.0"),u.classList.add("w-full"),u.classList.remove("w-0"),setTimeout(()=>{document.querySelectorAll("#streamURLBarTitleHelpText > .titleHelpText").forEach(t=>{t.classList.add("opacity-100"),t.classList.remove("opacity-0")})},1e3)):"close"==t&&(m.blur(),document.querySelectorAll("#streamURLBarTitleHelpText > .titleHelpText").forEach(t=>{t.classList.add("opacity-0"),t.classList.remove("opacity-100")}),setTimeout(()=>{u.classList.add("w-0"),u.classList.remove("w-full")},500))}function D(t){"open"==t?(g.innerHTML='<i class="fas fa-times" aria-hidden="true"></i>',h.classList.remove("h-0"),h.style.height=2.5*h.childElementCount+"rem",g.title="Close menu",g.classList.remove("bg-white"),g.classList.remove("rounded-r"),g.classList.add("rounded-br"),g.classList.add("bg-teal-300"),g.classList.add("shadow-inner"),setTimeout(()=>{document.querySelectorAll(".menuItem > .titleHelpText").forEach(t=>{t.classList.add("opacity-100"),t.classList.remove("opacity-0")}),document.querySelectorAll(".control > .titleHelpText").forEach(t=>{t.classList.add("opacity-100"),t.classList.remove("opacity-0")})},500)):"close"==t&&(document.querySelectorAll(".menuItem > .titleHelpText").forEach(t=>{t.classList.add("opacity-0"),t.classList.remove("opacity-100")}),document.querySelectorAll(".control > .titleHelpText").forEach(t=>{t.classList.add("opacity-0"),t.classList.remove("opacity-100")}),setTimeout(()=>{g.innerHTML='<i class="fas fa-bars" aria-hidden="true"></i>',h.classList.remove("h-0"),h.style.height="0rem",g.title="Open menu",g.classList.remove("bg-teal-300"),g.classList.remove("shadow-inner"),g.classList.remove("rounded-br"),g.classList.add("bg-white"),g.classList.add("rounded-r")},500))}function V(t){$(t),D(t)}function q(){null!=t&&(clearTimeout(t),t=void 0)}function P(t){u.style.opacity=t}function W(t){t.preventDefault(),t.returnValue=""}async function G(){let t=await fetch("feature-random-stream-game-ids.json");t.ok?(gameIdsFileJSON=await t.json(),e=Array.from(gameIdsFileJSON.twitch)):(console.error("HTTP-Error:"+t.status),alert("Hmmm couldn't retrieve game list. Please try again."),window.removeEventListener("beforeunload",W),location.reload())}function O(t){"random"===t?localStorage.setItem("rjp-afterAuthAction","random"):"stream"===t&&localStorage.setItem("rjp-afterAuthAction",y),window.removeEventListener("beforeunload",W),document.location.href=`https://id.twitch.tv/oauth2/authorize?client_id=${B}&redirect_uri=${"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:5500/":window.location.origin+window.location.pathname}&response_type=token`}document.getElementById("setupSplitViewButton").addEventListener("click",()=>{j("split")}),p.forEach(t=>{t.addEventListener("click",()=>{"swap"!=v&&j("swap"),_()})}),document.getElementById("setupSwapViewButton").addEventListener("click",()=>{"swap"==v?_():j("swap")}),document.getElementById("setupScrollViewButton").addEventListener("click",()=>{j("scroll")}),document.getElementById("setupSwipeViewButton").addEventListener("click",()=>{j("swipe")}),m.addEventListener("input",()=>{M(),z(),P("1.0")}),m.addEventListener("focus",()=>{q(),M(),z(),P("1.0"),async function(){let t=document.getElementById("followedStreamsList"),n=document.getElementById("followedStreamsListStatus");void 0===e&&await G();if(""!==E&&void 0!==e){n.classList.remove("hidden"),""===t.innerHTML?n.innerHTML="Generating list...":n.innerHTML="Updating list...";let a=await fetch("https://api.twitch.tv/helix/users",{headers:{"Client-ID":B,Authorization:"Bearer "+E}});if(a.ok){let n=await a.json(),l=[],o="";do{let t=await fetch(`https://api.twitch.tv/helix/users/follows?from_id=${n.data[0].id}&first=30&after=${o}`,{headers:{"Client-ID":B,Authorization:"Bearer "+E}}),a=await t.json(),s="";if(a.data.length>0){for(let t=0;t<a.data.length;t++)s+="user_id=",s+=a.data[t].to_id,t+1<a.data.length&&(s+="&");let t=await fetch("https://api.twitch.tv/helix/streams?"+s,{headers:{"Client-ID":B,Authorization:"Bearer "+E}});s="";for(let t=0;t<a.data.length;t++)s+="id=",s+=a.data[t].to_id,t+1<a.data.length&&(s+="&");let n=await fetch("https://api.twitch.tv/helix/users?"+s,{headers:{"Client-ID":B,Authorization:"Bearer "+E}});if(t.ok&&n.ok){let a=await t.json(),o=await n.json();for(let t=0;t<a.data.length;t++)for(let n=0;n<e.length;n++)if(e[n].game_id===a.data[t].game_id){let e=a.data[t];for(let n=0;n<o.data.length;n++)o.data[n].id===a.data[t].user_id&&(e.profile_image_url=o.data[n].profile_image_url);l.push(e)}}}o=void 0!==a.pagination.cursor?a.pagination.cursor:""}while(""!==o);l.length>0?(l.length,t.innerHTML="",l.forEach(n=>{let a="";for(let t=0;t<e.length;t++)e[t].game_id===n.game_id&&(a=e[t].game_name);t.innerHTML+=`\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="followedStream flex flex-row flex-no-wrap p-2 text-center align-middle cursor-pointer border-b border-solid border-gray-400 hover:bg-teal-100" \n\t\t\t\t\t\t\t\ttitle="${n.user_name+" playing "+a+" for "+(1===n.viewer_count?n.viewer_count+" viewer":0===n.viewer_count?"no one.":n.viewer_count.toLocaleString()+" viewers.")}" \n\t\t\t\t\t\t\t\tdata-stream-name="${n.user_name}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="flex-initial w-4/12 text-left truncate">\n\t\t\t\t\t\t\t\t\t<img src="${n.profile_image_url}" class="inline w-6 rounded">\n\t\t\t\t\t\t\t\t\t<span class="font-bold">${n.user_name}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="flex-grow text-left truncate">\n\t\t\t\t\t\t\t\t\t<span class="underline">${a}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="flex-initial w-3/12 text-right">\n\t\t\t\t\t\t\t\t\t${1===n.viewer_count?n.viewer_count+" viewer":0===n.viewer_count?"No viewers":n.viewer_count.toLocaleString()+" viewers"}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`}),document.querySelectorAll(".followedStream").forEach(t=>{t.addEventListener("click",()=>{m.value="https://twitch.tv/"+t.getAttribute("data-stream-name"),M(),z()})})):t.innerHTML='\n\t\t\t\t\t\t<div class="p-2 text-center">\n\t\t\t\t\t\t\tSorry, none of your followed streams are playing a Jackbox game.\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'}else t.innerHTML='\n\t\t\t\t\t<div class="p-2 text-center">\n\t\t\t\t\t\tHmm... couldn\'t connect to Twitch.<br />\n\t\t\t\t\t</div>\n\t\t\t\t';n.classList.add("hidden")}else t.innerHTML='\n\t\t\t\t<div class="p-2 text-center">\n\t\t\t\t\tWant to see which of your followed Twitch streams are playing Jackbox\n\t\t\t\t\tgames?<br />\n\t\t\t\t\t<button\n\t\t\t\t\t\tid="authorizeTwitchAccessButton"\n\t\t\t\t\t\tclass="bg-purple-500 text-white rounded mt-1 px-4 py-1 hover:bg-purple-600"\n\t\t\t\t\t>\n\t\t\t\t\t\tAuthorize <i class="fab fa-twitch"></i> access\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t',document.getElementById("authorizeTwitchAccessButton").addEventListener("click",()=>{O("stream")})}(),document.getElementById("followedStreamsListWrapper").classList.remove("scale-y-0"),(window.innerWidth<768||window.innerHeight<768)&&(document.getElementById("menu").classList.remove("mb-24"),document.getElementById("menu").classList.add("mb-6"))}),m.addEventListener("blur",()=>{M(),z(),document.getElementById("followedStreamsListWrapper").classList.add("scale-y-0"),(window.innerWidth<768||window.innerHeight<768)&&(document.getElementById("menu").classList.remove("mb-6"),document.getElementById("menu").classList.add("mb-24"))}),document.getElementById("streamURLForm").addEventListener("submit",(function(t){M(),z(),V("close"),t.preventDefault()})),window.addEventListener("resize",()=>{}),window.addEventListener("popstate",()=>{C(),M()}),document.getElementById("shareButton").addEventListener("click",()=>{q(),(t=>{const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e);const n=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);e.select(),document.execCommand("copy"),document.body.removeChild(e),n&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(n))})(L.toString().replace(L.hash,"")),document.getElementById("shareText").classList.add("px-1"),document.getElementById("shareText").classList.add("w-40"),document.getElementById("shareButton").classList.remove("rounded-r"),document.getElementById("shareTextDoppelganger").classList.add("px-1"),document.getElementById("shareTextDoppelganger").classList.add("w-40"),setTimeout(()=>{document.getElementById("shareText").classList.remove("px-1"),document.getElementById("shareText").classList.remove("w-40"),document.getElementById("shareButton").classList.add("rounded-r"),document.getElementById("shareTextDoppelganger").classList.remove("px-1"),document.getElementById("shareTextDoppelganger").classList.remove("w-40"),V("close")},3e3)}),document.getElementById("howToButton").addEventListener("click",()=>{Array.from(r.classList).includes("hidden")?(D("close"),U("howTo")):(M(),z())}),window.addEventListener("beforeunload",W),document.getElementById("reloadStreamButton").addEventListener("click",()=>{I="",S="",l.src="",M()}),document.getElementById("reloadGameButton").addEventListener("click",()=>{let t=!1;t=window.confirm("Reload the game?\nYou will lose your spot in the lobby."),!0===t&&(c.src="",c.src="https://jackbox.tv")}),g.addEventListener("click",()=>{g.title.includes("Open")?(V("open"),setTimeout(()=>{m.focus()},1e3)):g.title.includes("Close")&&(V("close"),m.blur())}),document.getElementById("hideStreamURLBarButton").addEventListener("click",()=>{$("close")}),document.querySelectorAll(".menuItem").forEach(t=>{t.addEventListener("mouseover",()=>{q()})}),document.querySelectorAll(".control").forEach(t=>{t.addEventListener("mouseover",()=>{q()})}),u.addEventListener("mouseover",()=>{q(),P("1.0")}),u.addEventListener("mouseout",()=>{""!=m.value&&P("0.5")}),document.getElementById("randomStreamButton").addEventListener("click",async()=>{if(m.disabled=!0,m.value="Searching...",void 0===e&&await G(),""!==E&&void 0!==e){let a=[],l=[],o="";for(let t=0;t<e.length;){let n=await fetch(`https://api.twitch.tv/helix/streams?language=en&first=30&game_id=${e[t].game_id}&after=${o}`,{headers:{"Client-ID":B,Authorization:"Bearer "+E}});if(n.ok){let e=await n.json();for(let t=0;t<e.data.length;t++)e.data[t].viewer_count<8&&l.push(e.data[t]);l.length<30&&null!=e.pagination.cursor?o=e.pagination.cursor:(o="",l.forEach(t=>a.push(t)),l=[],t++)}else if(console.error("HTTP-Error:"+n.status),401===n.status)return O("random")}let s=(t=0,n=a.length,t=Math.ceil(t),n=Math.floor(n),Math.floor(Math.random()*(n-t))+t);m.value="https://twitch.tv/"+a[s].user_name,m.disabled=!1,M(),z()}else""===E&&O("random");var t,n}),document.getElementById("showStreamURLBarButton").addEventListener("click",()=>{u.classList.toString().includes("w-full")?m.focus():($("open"),setTimeout(()=>{m.focus()},1e3))}),null!==localStorage.getItem("rjp-activeView")?j(localStorage.getItem("rjp-activeView")):localStorage.setItem("rjp-activeView",v),async function(){let t=await fetch("client-ids.json");if(t.ok){let e=await t.json();B=e["twitch-client-id"]}else console.error("Unable to get client ids. The application will not operate as intended. Please reload the page to try again.")}(),C()});